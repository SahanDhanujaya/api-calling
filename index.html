<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Management System</title>

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Poppins', sans-serif; }
        tr.selected { background-color: #e0e7ff; }
    </style>
</head>

<body class="bg-gradient-to-br from-indigo-100 to-purple-200 min-h-screen p-10">

<h1 class="text-4xl font-bold text-center text-indigo-700 mb-10">
    Student Management System
</h1>

<!-- FORM -->
<div class="max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-8">
    <h2 class="text-2xl font-semibold text-gray-700 mb-6 text-center">Student Details</h2>

    <form id="studentForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <input id = "name" type="text" name="name" placeholder="Name" class="border p-2 rounded" required>
        <input id = "email" type="email" name="email" placeholder="Email" class="border p-2 rounded bg-gray-100" required>
        <input id = "address" type="text" name="address" placeholder="Address" class="border p-2 rounded" required>
        <input id = "phone" type="text" name="phone" placeholder="Contact" class="border p-2 rounded" required>

        <div class="col-span-2 flex justify-center gap-4">
            <button type="submit" id="saveBtn"
                class="bg-indigo-600 text-white px-6 py-2 rounded">Save</button>
            <button type="button" id="editBtn"
                class="bg-blue-600 text-white px-6 py-2 rounded">Edit</button>
            <button type="reset" onclick="clearForm()"
                class="bg-gray-300 px-6 py-2 rounded">Clear</button>
        </div>
    </form>
</div>

<!-- TABLE -->
<div class="max-w-5xl mx-auto mt-12 bg-white rounded-xl shadow-lg overflow-hidden">
    <table class="w-full text-left">
        <thead class="bg-indigo-600 text-white">
            <tr>
                <th class="px-6 py-3">Name</th>
                <th class="px-6 py-3">Email</th>
                <th class="px-6 py-3">Address</th>
                <th class="px-6 py-3">Contact</th>
                <th class="px-6 py-3 text-center">Actions</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>
<script src="./jquery-3.7.1.min.js" ></script>
<script>
    const BASE_URL = 'http://localhost:8080';

    $('#saveBtn').click(function(event) {
        event.preventDefault();
        console.log('btn is working')

        if(!formVAlidation()){
            return;
        }

        const student = {
            name: $('#name').val(),
            email: $('#email').val(),
            address: $('#address').val(),
            phone: $('#phone').val()
        }

        $.ajax({
            url: `${BASE_URL}/save`,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(student),
            success: (res) => {
                alert(res.message)
                loadStudents()
                clearForm()
            }

        })
    })

    function loadStudents() {
    $.ajax({
        url: `${BASE_URL}/getAll`,
        method: "GET",
        success: function (data) {
            $("#tableBody").empty();

            data.forEach(st => {
                $("#tableBody").append(`
                    <tr class="hover:bg-indigo-50 cursor-pointer">
                        <td class="p-3">${st.name}</td>
                        <td class="p-3">${st.email}</td>
                        <td class="p-3">${st.address}</td>
                        <td class="p-3">${st.phone}</td>
                        <td class="p-3 text-center">
                            <button class="text-blue-600 mr-2 select-btn" id="${st.id}">Select</button>
                            <button class="text-red-600 delete-btn">Delete</button>
                        </td>
                    </tr>
                `);
            });
        }
    });
}

let id = null;

$(document).on('click', '.select-btn', function (event) {
    event.preventDefault();

    id = $(this).attr('id');
    console.log("Selected ID:", id);

    $.ajax({
        url: `${BASE_URL}/getById/${id}`,
        method: 'GET',
        success: function (data) {
            $('#name').val(data.name);
            $('#email').val(data.email);
            $('#address').val(data.address);
            $('#phone').val(data.phone);
        }
    });
});


$('#editBtn').click(function(event) {
    event.preventDefault();
    console.log('edit btn is working')

    if(!formVAlidation()){
        return;
    }

    const student = {
        name: $('#name').val(),
        email: $('#email').val(),
        address: $('#address').val(),
        phone: $('#phone').val()
    }

    $.ajax({
        url: `${BASE_URL}/update/${id}`,
        method: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify(student),
        success: (res) => {
            alert(res.message)
            loadStudents()
            clearForm()
        }
    })
});


$(document).on('click', '.delete-btn', function(event) {
    event.preventDefault();
    $.ajax({
        url: `${BASE_URL}/delete/${id}`,
        method: 'DELETE',
        success: (res) => {
            alert(res.message)
            loadStudents()
        }
    })
});

const formVAlidation = ()=>{
    const name = $('#name').val()
    const email = $('#email').val()
    const address = $('#address').val()
    const phone = $('#phone').val()

    if(name == ''){
        alert('Name is required')
        return false   
    } else if(email == '' || !email.includes('@gmail.com')){
        alert('Email is required')
        return false
    } else if (address == '') {
        alert('Address is required')
        return false
    } else if (phone == '' || phone.length != 10) {
        alert('Phone number is required')
        return false
    } else {
        return true
    }
    
}

window.onload = () => {
    loadStudents()
}

const clearForm = ()=> {
    $('#name').val('')
    $('#email').val('')
    $('#address').val('')
    $('#phone').val('')
}
    

</script>
</body>
</html>
